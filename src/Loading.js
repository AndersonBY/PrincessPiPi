var logoData = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAELCAMAAADAwCB+AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpjYWI0Nzc4ZC1kMGM5LTNmNGYtYWIwNy0xZjRjNjk1YTU3OGEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MkU5MjI0NDJBNjI0MTFFNDhCOThCMDM0ODcwRkUwMjYiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MkU5MjI0NDFBNjI0MTFFNDhCOThCMDM0ODcwRkUwMjYiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjdlZjkyMzkwLTRjYjYtNmY0Yy04ZjUwLWEyMjZiYjMyNTUzZCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpjYWI0Nzc4ZC1kMGM5LTNmNGYtYWIwNy0xZjRjNjk1YTU3OGEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz62eBxMAAABqlBMVEX2np7+9/fyd3f60ND0ior//v7xcHD//Pz719f85OT83t7yfn7zgoL72dnyfX3zf3/4uLj//f395+f95ub2p6f2pqb0iYnzgYH84+P3q6v3rq772tr71tbzg4P0i4vxcXHziIj+9fX4t7f/+/v3qan96Oj2paX2pKT4urr0kJD+9vbydnb83NzyeXn0jIzye3v6zc3++Pj3r6/3ra34trbxdHT83d3zgIDyeHj+8vLzhIT1l5f0kZH1lJT0jY31lZX6ysr97+/1nZ3ydXX3qqr70tL71dXyenr4vLz3sbH+8fH709PxcnL6y8v6zMz6ycn85eX4u7v/+vr+9PT829v1nJz2oaH1mpr1mJj+8/P5w8P6yMj3qKj97Oz0k5P97e34tLT97u7839/zhYX70dH96uryfHz6z8/zh4f++fn2nZ384uL71NT6x8fzhob2oKD5xcX6zs772Nj4s7P3sLDxc3P3srL1lpb2n5/0kpL5xMT2oqL1m5v3rKz5wsL60dH+8PD5vb31k5P1mZn2o6P5wMD4tbX0j4/5wcH4ubn444nxb2/////////9kB9CAAAAjnRSTlP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8Am570egAAD8ZJREFUeNrsnfdfFEkahxuGGYKAgnqygA6oqICK4KLElWBYs2daw5nDGte9zXn38l1Xz/98TGJSV9X7Vr3d0zP9fvfjD9sTqWfeVPVWtZNhRUoODwEDYTEQBsJiIAyExUAYCIuBMBAWA2ExEAbCYiAMhMVAGAiLgTAQFgNhMZDw5EnFQEJnoeTBQCJjGkAkDIQMRPEfA2kQEDAkDCRwF8VAIoxCj4SB1AEHAyGPF7ZA5EgYSGhWwUCiSUJDhIEoQdC4JwwRBuI//REgiE0gHgMJy0clt3du6Ol/2sr0/hHIRBhIhjJ3Kuqjgxv6IMr1yX2Q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"

/**
* Used to display the loading screen
* @class
* @extends cc.Scene
*/
Loading = cc.Scene.extend(/** @lends cc.LoaderScene# */{
	_logo: null,
	_logoTexture: null,
	_texture2d: null,
	_bgLayer: null,
	_label: null,
	_winSize:null,
	_processLayer: null,
	_processLayerLength: null,

	/**
	* Constructor
	*/
	ctor: function () {
		this._super();
		this._winSize = cc.winSize;
	},
	init:function(){
		cc.Scene.prototype.init.call(this);

		//logo
		var logoHeight = 267;
		var centerPos = cc.p(this._winSize.width / 2, this._winSize.height / 2);

		this._logoTexture = new Image();
		var _this = this;
		this._logoTexture.addEventListener("load", function () {
			_this._initStage(centerPos);
		});
		this._logoTexture.src = logoData;
		this._logoTexture.width = 400;
		this._logoTexture.height = 267;		

		// bg
		this._bgLayer = cc.LayerColor.create(cc.Color(200, 200, 200, 255));
		this._bgLayer.setPosition(cc.p(0, 0));
		this.addChild(this._bgLayer, 0);

		//loading percent
		this._label = cc.LabelTTF.create("Loading... 0%", "Arial", 24);
		this._label.setColor(cc.color(180, 180, 180));
//		this._label.setFontFillColor(cc.Color(80, 80, 80, 100));
		this._label.setOpacity(0);
		this._label.setPosition(cc.pAdd(centerPos, cc.p(0, -logoHeight / 2 - 100)));		
		this._bgLayer.addChild(this._label, 10);

		this._processLayerLength = 500;
		this._processLayer = cc.LayerColor.create(cc.Color(255, 100, 100, 128), 1, 30);
		this._processLayer.setPosition(cc.pAdd(centerPos, cc.p(- this._processLayerLength / 2, -logoHeight / 2 - 50)));

		this._bgLayer.addChild(this._processLayer);
	},

	_initStage: function (centerPos) {
		if (cc.renderContextType === cc.CANVAS) {
			this._logo = cc.Sprite.createWithTexture(this._logoTexture);
		} else {
			this._texture2d = new cc.Texture2D();
			this._texture2d.initWithElement(this._logoTexture);
			this._texture2d.handleLoadedTexture();
			this._logo = cc.Sprite.createWithTexture(this._texture2d);
		}
		this._logo.setPosition(centerPos);
		this._bgLayer.addChild(this._logo, 10);
		//load resources
		this._logoFadeIn();
	},

	onEnter: function () {
		cc.Node.prototype.onEnter.call(this);
		this.schedule(this._startLoading, 0.3);
	},

	onExit: function () {
		cc.Node.prototype.onExit.call(this);
		var tmpStr = "Loading... 0%";
		this._label.setString(tmpStr);
	},

	/**
	 * init with resources
	 * @param {Array} resources
	 * @param {Function|String} selector
	 * @param {Object} target
	 */
	initWithResources: function (resources, cb) {
		if(cc.isString(resources))
			resources = [resources];
		this.resources = resources || [];
		this.cb = cb;
	},

	_startLoading: function () {
		var self = this;
		self.unschedule(self._startLoading);
		var res = self.resources;
		cc.loader.load(res,
			function (result, count, loadedCount) {
				var percent = (loadedCount / count * 100) | 0;
				percent = Math.min(percent, 100);
				self._label.setString("Loading... " + percent + "%");
			}, function () {
				if (self.cb)
				self.cb();
			});
	},

	_logoFadeIn: function () {
		var logoAction = cc.Spawn.create(
				cc.EaseBounce.create(cc.MoveBy.create(0.25, cc.p(0, 10))),
				cc.FadeIn.create(0.5));

		var labelAction = cc.Sequence.create(
				cc.DelayTime.create(0.15),
				logoAction.clone());

		this._logo.runAction(logoAction);
		this._label.runAction(labelAction);
	},

});

Loading.preload = function (resources, cb) {
	var _cc = cc;
	if(!_cc.loaderScene) {
		_cc.loaderScene = new Loading();
		_cc.loaderScene.init();
	}
	_cc.loaderScene.initWithResources(resources, cb);
	
	var _hmt = _hmt || [];
	(function() {
		var hm = document.createElement("script");
		hm.src = "//hm.baidu.com/hm.js?128578ac31fb1e0c7b8f342e84b3107e";
		var s = document.getElementsByTagName("script")[0]; 
		s.parentNode.insertBefore(hm, s);
	})();
	
	cc.director.runScene(_cc.loaderScene);
	return _cc.loaderScene;
};